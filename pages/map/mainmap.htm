<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,install-scale=1.0">
    <meta http-equiv="X-UA-Compatible"  content="ie=edge">

    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><!--转化http协议的js库-->

    <title>This is a test</title>
    <link rel="stylesheet" href="../../libs/ol.css" >
    

    <!--要用页面单独的格式设置，不然显示会较为麻烦，这里就不引用style.css了-->
    <style type="text/css">
        body, html{width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
        #map{height:95%;width:100%;}
        #search{width:100%; font-size:14px;top:565px;overflow: hidden;}
    </style> 

    <script type="text/javascript"
    src="http://api.map.baidu.com/api?v=2.0&ak=kB5yeVizxgKa82lXGOdvTiEpyzPeEzSx"></script>

    <script src="../../libs/ol.js"></script>
 

</head>

<body>
<div id=map class="map"></div>
<div id="search" >
    城市名: <input id="cityName" type="text" style="width:100px; margin-right:10px;" />
    经度: <input type="text" id="jingdu" />
    纬度: <input type="text" id="weidu" />
    <input type="button" value="查询" onclick="theLocation()" />

    <input type="button" value="定位" id="spin"></input>
</div>
<script>
     var map=new ol.Map({
    target:'map',
            layers:[new ol.layer.Tile({source:new ol.source.OSM()})],
            view:new ol.View({
                center:[0,0],
                projection:'EPSG:3857',
                zoom:0
            }),
            controls:ol.control.defaults().extend([
            new ol.control.ZoomSlider(),

            new ol.control.ZoomToExtent({
                extent:[
                  12728348,3570593,
                  12732131,3574443
                  //定位whu
                ]
            }),

            new ol.control.MousePosition(),

            new ol.control.FullScreen(),
            
            new ol.control.OverviewMap({        // 实例化一个OverviewMap类的对象，并加入到地图中
                    collapsed: false,

                    //教程有误，需要加入新的layers和view，否则鹰眼框与主视图使用统一图层会显示空白
                    layers:[new ol.layer.Tile({source:new ol.source.OSM()})],
                    view:new ol.View({
                        center:[0,0],
                        projection:'EPSG:3857',
                        zoom:4
                    }),
                }),   
                
                new ol.control.ScaleLine({
                    units: "metric" ,//设置比例尺单位，degrees、imperial、us、nautical、metric（度量单位）
                    bar:false
                }),

                ]) 
        });

    var baidumap = new BMap.Map("allmap");
    //开始搜索功能的添加
    function theLocation() {
        var localSearch = new BMap.LocalSearch(baidumap);
        //查询城市坐标的方法
        var keyword = document.getElementById("cityName").value;
        localSearch.setSearchCompleteCallback(function (searchResult) {
            var poi = searchResult.getPoi(0);
            console.log(searchResult);

            document.getElementById("jingdu").value = poi.point.lng; //获取经度和纬度，将结果显示在文本框中
            document.getElementById("weidu").value = poi.point.lat; //获取经度和纬度，将结果显示在文本框中


        });
        localSearch.search(keyword);
    }
</script>


<script>
    // var getspin = document.getElementById("spin");
   /*  getspin.addEventListener("click", function () {
        var a = document.getElementById('jingdu').value;
        var b = document.getElementById('weidu').value;
        var thisview = map.getView();
        var center = thisview.getCenter();
        var shenyang = ol.proj.fromLonLat([a, b]);

        thisview.animate({
            center: [
                center[0] + (shenyang[0] - center[0]) / 2,
                center[1] + (shenyang[1] - center[1]) / 2
            ],
            rotation: Math.PI,
            easing: ol.easing.easeIn
        }, {
            center: shenyang,
            rotation: 2 * Math.PI,
            easing: ol.easing.easeOut
        });
    }) */
    var getspin = document.getElementById("spin");

    function elastic(t) {
            return Math.pow(2, -10 * t) * Math.sin((t - 0.075) * (2 * Math.PI) / 0.3) + 1;
        }

    getspin.addEventListener("click", function (){
            
        var a = document.getElementById('jingdu').value;
        var b = document.getElementById('weidu').value;
        var thiscenter=ol.proj.fromLonLat([a, b]);
        var thisview = map.getView();
        thisview.animate({
                center: thiscenter,
                duration: 2000,
                easing: elastic
            });
        });

</script>
</body>
